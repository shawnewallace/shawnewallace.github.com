---
layout: post
title: Running NUnit Tests in TFS 2010 Continuous Build Environment
tags: [Patterns & Practices, Legacy]
published: true
---

<p>Microsoft Team Foundation Server 2010 does not provide an easy way to run NUnit test as part of the continuous integration process. Some pretty intense work goes into running those unit tests, and even more is required if build success should depend on unit test success.</p> <p>Download: <a href="http://dl.dropbox.com/u/4478420/Build%20Definition%20Tests%20Section%20for%20NUnit.txt">NUnit Test Execution Action Section</a></p> <h2>Strategy:</h2> <p>The build strategy should be implemented in a Build Process Template. The strategy incorporates input from the Build Definition. For example, if the Build Definition notes that test should not be run, then the test assemblies will not be exercised by NUnit.</p> <p><a href="http://lh4.ggpht.com/-qoeLJdnA-uM/T3294Jq-DjI/AAAAAAAAABM/Gx_FR1cz6cQ/s1600-h/Disable%252520tests%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Disable tests" border="0" alt="Disable tests" src="http://lh3.ggpht.com/-Ni5bskAdCY0/T3296eeQirI/AAAAAAAAABU/4SCdvcfi90k/Disable%252520tests_thumb%25255B1%25255D.jpg?imgmax=800" width="402" height="158"></a></p> <p>If the build is set to fail on failed tests, then the entire build will be failed if there are ''any'' test errors or failures.</p> <p>If the build is not set to fail on test failure and there are failed tests, then the build will be considered partially successful.</p> <p><a href="http://lh4.ggpht.com/-zJU2l8z16uU/T3297ILKHLI/AAAAAAAAABc/kab8eLQGv3I/s1600-h/Fail%252520test%252520on%252520build%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Fail test on build" border="0" alt="Fail test on build" src="http://lh6.ggpht.com/-a6B8dx52tHU/T32997mNMiI/AAAAAAAAABk/ExVg2DBWJMM/Fail%252520test%252520on%252520build_thumb%25255B1%25255D.jpg?imgmax=800" width="529" height="192"></a></p> <p><a href="http://lh6.ggpht.com/--NlupD-sf9o/T329-xjNsxI/AAAAAAAAABs/foGp3MfC0kM/s1600-h/Build%252520Success%252520Indicators%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Build Success Indicators" border="0" alt="Build Success Indicators" src="http://lh4.ggpht.com/-rQgwnuCFTxc/T32-B0CvnZI/AAAAAAAAAB0/7LC6Q2T1eeU/Build%252520Success%252520Indicators_thumb%25255B1%25255D.jpg?imgmax=800" width="509" height="109"></a></p> <p>Failed tests that cause build failure are Build Exceptions on the Build Summary page.<br><a href="http://lh6.ggpht.com/-o2X6LlWk33Q/T32-DQD_bMI/AAAAAAAAAB8/roL4eiAryNI/s1600-h/Build%252520Errors%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Build Errors" border="0" alt="Build Errors" src="http://lh6.ggpht.com/-FrSvZA9ImaQ/T32-EVYXIwI/AAAAAAAAACE/FwzBtOwP0RI/Build%252520Errors_thumb%25255B1%25255D.jpg?imgmax=800" width="760" height="114"></a></p> <p>Failed tests that do not cause build failure a Build Warnings on the Build Summary page.<br><a href="http://lh6.ggpht.com/-Wl_SKA2WlCw/T32-FxclTrI/AAAAAAAAACM/Vz5GLIWiQbY/s1600-h/Build%252520Warnings%25255B5%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Build Warnings" border="0" alt="Build Warnings" src="http://lh5.ggpht.com/-T-L7ZPtB6YA/T32-HtVBqqI/AAAAAAAAACU/MqCXKSUlK_w/Build%252520Warnings_thumb%25255B3%25255D.jpg?imgmax=800" width="644" height="71"></a></p> <p>Detailed output for failed tests can be viewed on the "View Log" link on the Build Summary page.</p> <p><a href="http://lh6.ggpht.com/-sCZ-WMhjsXk/T32-IoyezhI/AAAAAAAAACc/9IVrUfv3UDU/s1600-h/View%252520Log%252520Link%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="View Log Link" border="0" alt="View Log Link" src="http://lh6.ggpht.com/-Po9Xb9pi3hY/T32-J1AphII/AAAAAAAAACk/7vcU3TqpsvI/View%252520Log%252520Link_thumb%25255B1%25255D.jpg?imgmax=800" width="644" height="114"></a></p> <h3>Following are some highlighted steps that are necessary as part of the process to exercise the NUnit tests in TFS 2010.</h3> <h5>1) Determine the test assemblies based on the Test Assembly Wildcard Selector specified in the Build Process Parameters.</h5> <p>The Test Assembly Filespec parameter is used to determine which solution assemblies should be processed by NUnit. This can be modified based on a specific project's needs.</p> <p><a href="http://lh4.ggpht.com/-IGTjFRawwS8/T32-L_pzWWI/AAAAAAAAACs/I-k8joU8EQo/s1600-h/Test%252520Assembly%252520Filter%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Test Assembly Filter" border="0" alt="Test Assembly Filter" src="http://lh3.ggpht.com/-ZPX3YOtvVlU/T32-NFCZQzI/AAAAAAAAAC0/xPvwYV6-7_g/Test%252520Assembly%252520Filter_thumb%25255B1%25255D.jpg?imgmax=800" width="644" height="134"></a></p> <h5>2) Execute the NUnit tests on each test assembly</h5> <p><a href="http://lh6.ggpht.com/-WZVgioS3wr0/T32-PHSQbJI/AAAAAAAAAC8/HQzV_momUSk/s1600-h/Execute%252520NUnit%252520workflow%252520action%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Execute NUnit workflow action" border="0" alt="Execute NUnit workflow action" src="http://lh6.ggpht.com/-GY_xGc6XZCM/T32-QgwqKAI/AAAAAAAAADE/6F5fvlRZ5vM/Execute%252520NUnit%252520workflow%252520action_thumb%25255B1%25255D.jpg?imgmax=800" width="317" height="484"></a></p> <p>The nunit-console application is called on each test assembly.</p> <blockquote> <p>nunit-console.exe &lt;assembly path&gt; /xml:&lt;result target path&gt; /nologo /nodots</p></blockquote> <h5>3) Take appropriate action for failed tests</h5> <p>The existence of failed tests is determined by parsing the output generated by executing the tests. This output is stored in a local variable.</p> <p><a href="http://lh4.ggpht.com/-EZutvNVj3pk/T32-SEc6WCI/AAAAAAAAADM/-vVOuiWwLRo/s1600-h/Handle%252520Failed%252520Test%252520Workflow%252520Action%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Handle Failed Test Workflow Action" border="0" alt="Handle Failed Test Workflow Action" src="http://lh3.ggpht.com/-6Btz1yXpaa0/T32-TzoOZTI/AAAAAAAAADU/9S4PpZJUgjI/Handle%252520Failed%252520Test%252520Workflow%252520Action_thumb%25255B2%25255D.jpg?imgmax=800" width="622" height="548"></a></p> <p>The test is considered failed the following condition is met.</p> <blockquote> <p>(Not stdOutput.Contains("Failures: 0") And stdOutput.Contains("Failures:")) Or (Not stdOutput.Contains("Errors: 0") And stdOutput.Contains("Errors:"))<br>Where stdOutput is the output generated from the executed tests.</p></blockquote> <p>'''When there is a failing test'''</p> <ul> <li>the Build Detail Test Status is put into a failed state.  <li>if "Treat Test Failures as Build Failures" is selected, then a Build Error is generated  <li>if "Treat Test Failures as Build Failures" is <em>not</em> selected, then a Build Warning is generated</li></ul> <h2>Using:</h2><br> <p>Executing the NUnit tests requires reworking the default "If Not DisableTests" workflow step in the build process template. Build process templates are XAML files. They can be edited in the workflow editor in Visual Studio 2010 or in a text editor. If modified in a text editor, care should be taken to ensure the final product is a valid TFS TeamBuild Workflow XAML file.</p> <p>To add the NUnit test runner to the default build process template (<a href="http://dl.dropbox.com/u/4478420/Build%20Definition%20Tests%20Section%20for%20NUnit.txt">Download Here</a>), <em>If</em> Control Flow section with the XAML from the attached file.</p> <p><a href="http://lh4.ggpht.com/-jNOzxFQO6Hw/T32-UwQb1aI/AAAAAAAAADc/xjvudKYa2N4/s1600-h/If%252520Not%252520Disable%252520Tests%25255B6%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="If Not Disable Tests" border="0" alt="If Not Disable Tests" src="http://lh3.ggpht.com/-0vaFVcFGvSk/T32-WOWZXII/AAAAAAAAADk/uUBYT7nzQ88/If%252520Not%252520Disable%252520Tests_thumb%25255B2%25255D.jpg?imgmax=800" width="322" height="484"></a></p> <p>To use the new build process definition template that has implemented the NUnit test runner, a new build process should be created and the new template should be used.</p> <p><a href="http://lh5.ggpht.com/-dFvEDmYNG8w/T32-XRDOKcI/AAAAAAAAADs/H6LXWwngUpU/s1600-h/Select%252520Build%252520Process%252520Template%25255B3%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Select Build Process Template" border="0" alt="Select Build Process Template" src="http://lh4.ggpht.com/--hXwiTQ_PqY/T32-YwLP4RI/AAAAAAAAAD0/IYnMGz7qo6g/Select%252520Build%252520Process%252520Template_thumb%25255B1%25255D.jpg?imgmax=800" width="644" height="146"></a></p> <p>All builds now executed will execute the NUnit tests in place of the standard MSTest test suite.</p> <p>Download: [<span style="font-size: 19px" class="Apple-style-span"><a href="http://dl.dropbox.com/u/4478420/Build%20Definition%20Tests%20Section%20for%20NUnit.txt">NUnit Test Execution Action Section</a></span><span style="font-size: 15px" class="Apple-style-span">]</span></p>  